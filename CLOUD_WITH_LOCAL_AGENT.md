# CartWise Pro - Cloud + Local Agent Setup
## ××“×¨×™×š ×”×§××ª ××¢×¨×›×ª ×”×™×‘×¨×™×“×™×ª: ×¢× ×Ÿ + ×¨×¡×¤×‘×¨×™ ××§×•××™

---

## ğŸ¯ ×¡×§×™×¨×” ×›×œ×œ×™×ª

××¢×¨×›×ª CartWise Pro ×¢×›×©×™×• ×ª×•××›×ª ×‘××¨×›×™×˜×§×˜×•×¨×” ×”×™×‘×¨×™×“×™×ª:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   INTERNET / ××™× ×˜×¨× ×˜                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Render.com Cloud API                                  â”‚ â”‚
â”‚  â”‚  https://cartwise-cloud.onrender.com                   â”‚ â”‚
â”‚  â”‚  - ×××©×§ REST API                                       â”‚ â”‚
â”‚  â”‚  - ××™××•×ª SMS (Inforu)                                  â”‚ â”‚
â”‚  â”‚  - × ×™×”×•×œ ×”×©×›×¨×•×ª                                        â”‚ â”‚
â”‚  â”‚  - ×ª×§×©×•×¨×ª ×¢× agents                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚ HTTPS/Polling                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                  â”‚                                         â”‚
                  â–¼                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”
â”‚  ×œ×§×•×— ×‘× ×™×™×“/××—×©×‘                     â”‚    â”‚               â”‚  â”‚
â”‚  https://cartwise-cloud.onrender.com â”‚    â”‚  ×œ×§×•×— ×‘××¡×š    â”‚  â”‚
â”‚                                       â”‚    â”‚  ×”×¨×¡×¤×‘×¨×™      â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜
                                                             â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”
                  â”‚  RASPBERRY PI (×‘×—× ×•×ª)                    â”‚ â”‚
                  â”‚                                          â”‚ â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
                  â”‚  â”‚  1. Chromium Kiosk                 â”‚  â”‚ â”‚
                  â”‚  â”‚     ××¦×™×’ ×××©×§ ××”×¢× ×Ÿ                â”‚  â”‚ â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
                  â”‚                                          â”‚ â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
                  â”‚  â”‚  2. Local Agent (Python)           â”‚  â”‚ â”‚
                  â”‚  â”‚     - Poll commands from cloud     â”‚  â”‚ â”‚
                  â”‚  â”‚     - Execute RS485 commands       â”‚  â”‚ â”‚
                  â”‚  â”‚     - Report status back           â”‚  â”‚ â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
                  â”‚             â”‚ Serial RS485               â”‚ â”‚
                  â”‚             â–¼                            â”‚ â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
                  â”‚  â”‚  RS232â†’RS485 â†’ CU16 â†’ Locks        â”‚  â”‚ â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”˜
```

---

## ğŸ“¦ ×¨×›×™×‘×™ ×”××¢×¨×›×ª

### 1. **Cloud API (Render.com)**
- ××©×¨×ª ××ª ×”×××©×§ ×œ×œ×§×•×—×•×ª
- ×× ×”×œ ××™××•×ª SMS
- ×× ×”×œ ×”×©×›×¨×•×ª ×•××¢×§×‘
- ××ª×§×©×¨ ×¢× ×¨×¡×¤×‘×¨×™ ××§×•××™

### 2. **Raspberry Pi Local Agent**
- ××¦×™×’ ×××©×§ ×‘×›×™×•×¡×§ (××¡×š ××’×¢)
- ××§×©×™×‘ ×œ×¤×§×•×“×•×ª ××”×¢× ×Ÿ
- ×©×•×œ×˜ ×‘×× ×¢×•×œ×™ RS485
- ××“×•×•×— ×¡×˜×˜×•×¡ ×—×–×¨×”

### 3. **RS485 Controller**
- KERONG CU16
- 16 ×× ×¢×•×œ×™×
- ××ª×× RS232â†’RS485

---

## ğŸš€ ×©×œ×‘×™ ×”×”×ª×§× ×”

### ×©×œ×‘ 1: ×¤×¨×™×¡×ª Cloud API (Render.com)

#### 1.1 - ×¦×•×¨ Web Service ×‘-Render

1. ×’×© ×œ: https://dashboard.render.com
2. ×œ×—×¥ **"New +" â†’ "Web Service"**
3. ×—×‘×¨ GitHub: `https://github.com/Arviv123/CartWise`
4. ×”×’×“×¨×•×ª:
   ```
   Name: cartwise-cloud
   Environment: Docker
   Branch: main
   Region: Frankfurt (××• Oregon)
   Instance Type: Starter ($7/mo) - ××•××œ×¥!
   ```

#### 1.2 - Environment Variables

×”×•×¡×£ ××ª ×”××©×ª× ×™× ×”×‘××™×:

```bash
API_HOST=0.0.0.0
API_PORT=8002
DEMO_MODE=true
INFORU_USERNAME=Arviv123
INFORU_PASSWORD=7d9b64ad-1ece-40be-906b-95ef67bdad2d
```

#### 1.3 - Deploy

×œ×—×¥ **"Create Web Service"** ×•×”××ª×Ÿ 3-5 ×“×§×•×ª.

×ª×§×‘×œ URL ×›××•:
```
https://cartwise-cloud.onrender.com
```

#### 1.4 - ×‘×“×•×§ ×©×”×›×œ ×¢×•×‘×“

×’×© ×œ:
```
https://cartwise-cloud.onrender.com/docs
```

×ª×¨××” ××ª ×”-API Documentation.

---

### ×©×œ×‘ 2: ×”×›× ×ª Raspberry Pi

#### 2.1 - ×”×ª×§× ×ª ××¢×¨×›×ª ×”×¤×¢×œ×”

1. ×”×•×¨×“ **Raspberry Pi Imager**
2. ×¦×¨×•×‘ **Raspberry Pi OS Lite (64-bit)**
3. ×”×¤×¢×œ ×•×”×ª×—×‘×¨ ×œ××¡×š

#### 2.2 - ×”×ª×§× ×ª ×ª×œ×•×™×•×ª

```bash
# ×¢×“×›×Ÿ ××¢×¨×›×ª
sudo apt update && sudo apt upgrade -y

# Python ×•-tools
sudo apt install -y python3 python3-pip python3-venv git

# Chromium ×¢×‘×•×¨ Kiosk
sudo apt install -y chromium-browser unclutter xorg openbox lightdm

# ×”×•×¨×“ ××ª ×”×§×•×“
cd ~
git clone https://github.com/Arviv123/CartWise.git cartwise
cd cartwise

# ×¦×•×¨ virtual environment
python3 -m venv venv
source venv/bin/activate

# ×”×ª×§×Ÿ requirements
pip install -r requirements.txt

# ×”×¨×©××•×ª serial port
sudo usermod -a -G dialout $USER
```

#### 2.3 - ×¦×•×¨ ×ª×¦×•×¨×”

```bash
nano ~/agent_config.sh
```

×”×›× ×¡:

```bash
#!/bin/bash

# Cloud Configuration
export CLOUD_URL="https://cartwise-cloud.onrender.com"
export BRANCH_ID="branch_001"  # ×©× ×” ×œ×¤×™ ×”×¡× ×™×£
export API_KEY="$(python3 -c 'import secrets; print(secrets.token_urlsafe(32))')"

# RS485 Configuration
export SERIAL_PORT="/dev/ttyUSB0"
export BAUDRATE="19200"

# Kiosk Configuration
export KIOSK_URL="https://cartwise-cloud.onrender.com/"
```

×©××•×¨: `Ctrl+O`, ×¡×’×•×¨: `Ctrl+X`

×”×¤×¢×œ ××ª ×”×ª×¦×•×¨×”:
```bash
chmod +x ~/agent_config.sh
source ~/agent_config.sh
```

**×—×©×•×‘!** ×©××•×¨ ××ª ×”-API_KEY - ×ª×¦×˜×¨×š ××•×ª×•!

---

### ×©×œ×‘ 3: ×”×¤×¢×œ×ª Local Agent

#### 3.1 - ×‘×“×™×§×” ×™×“× ×™×ª

```bash
cd ~/cartwise
source venv/bin/activate
source ~/agent_config.sh

python raspberry_pi/local_agent.py \
    --cloud-url $CLOUD_URL \
    --branch-id $BRANCH_ID \
    --api-key $API_KEY \
    --serial-port $SERIAL_PORT \
    --baudrate $BAUDRATE
```

×ª×¨××”:
```
============================================================
Starting CartWise Local Agent
============================================================
RS485 controller connected successfully
Successfully registered with cloud
Agent is now running - polling for commands...
============================================================
Heartbeat sent
```

**×× ×¨×•××” ××ª ×–×” - ××¢×•×œ×”! ×–×” ×¢×•×‘×“! âœ…**

#### 3.2 - ×”×¤×¢×œ×” ××•×˜×•××˜×™×ª (systemd service)

```bash
sudo nano /etc/systemd/system/cartwise-agent.service
```

×”×›× ×¡:

```ini
[Unit]
Description=CartWise Local Agent
After=network.target

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/cartwise
Environment="PATH=/home/pi/cartwise/venv/bin"
EnvironmentFile=/home/pi/agent_config.sh
ExecStart=/home/pi/cartwise/venv/bin/python raspberry_pi/local_agent.py --cloud-url ${CLOUD_URL} --branch-id ${BRANCH_ID} --api-key ${API_KEY} --serial-port ${SERIAL_PORT} --baudrate ${BAUDRATE}
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

×©××•×¨ ×•×”×¤×¢×œ:

```bash
sudo systemctl enable cartwise-agent
sudo systemctl start cartwise-agent
sudo systemctl status cartwise-agent
```

---

### ×©×œ×‘ 4: ×”×’×“×¨×ª Kiosk Mode

#### 4.1 - ×¦×•×¨ ×¡×§×¨×™×¤×˜ Kiosk

```bash
nano ~/start_kiosk.sh
```

×”×›× ×¡:

```bash
#!/bin/bash

source ~/agent_config.sh

# Wait for X server
sleep 5

# Hide mouse
unclutter -idle 0.1 &

# Disable screen blanking
xset s off
xset s noblank
xset -dpms

# Start Chromium in kiosk mode
chromium-browser \
    --kiosk \
    --noerrdialogs \
    --disable-infobars \
    --no-first-run \
    --start-fullscreen \
    $KIOSK_URL
```

×©××•×¨ ×•×”×¤×¢×œ ×”×¨×©××•×ª:

```bash
chmod +x ~/start_kiosk.sh
```

#### 4.2 - ×”×’×“×¨ Auto-start

```bash
mkdir -p ~/.config/openbox
nano ~/.config/openbox/autostart
```

×”×›× ×¡:

```bash
# Disable screen blanking
xset s off
xset s noblank
xset -dpms

# Start CartWise Kiosk
/home/pi/start_kiosk.sh &
```

#### 4.3 - ×”×’×“×¨ Auto-Login

```bash
sudo raspi-config
```

- **System Options** â†’ **Boot / Auto Login** â†’ **Desktop Autologin**

×”×¤×¢×œ ××—×“×©:

```bash
sudo reboot
```

---

## âœ… ×‘×“×™×§×” ××œ××”

### 1. ×‘×“×•×§ Cloud API

×¤×ª×— ×“×¤×“×¤×Ÿ ×•×’×© ×œ:
```
https://cartwise-cloud.onrender.com/
```

×ª×¨××” ××ª ×××©×§ ×”×œ×§×•×—.

### 2. ×‘×“×•×§ Local Agent

×¢×œ ×”×¨×¡×¤×‘×¨×™:

```bash
sudo journalctl -u cartwise-agent -f
```

×ª×¨××”:
```
Heartbeat sent
Agent is now running - polling for commands...
```

### 3. ×‘×“×•×§ Kiosk

×”××¡×š ×©×œ ×”×¨×¡×¤×‘×¨×™ ×××•×¨ ×œ×”×¦×™×’ ××ª ×”×××©×§ ×‘××¡×š ××œ×.

### 4. ×‘×“×•×§ ×ª×§×©×•×¨×ª ××œ××”

1. **×‘××¡×š ×”×¨×¡×¤×‘×¨×™** ××• **×‘× ×™×™×“** (https://cartwise-cloud.onrender.com):
   - ×œ×—×¥ "×œ×§×™×—×ª ×¢×’×œ×”"
   - ×”×–×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ
   - ×§×‘×œ SMS
   - ×”×–×Ÿ ×§×•×“

2. **×”×¢× ×Ÿ** ×©×•×œ×— ×¤×§×•×“×” unlock ×œ×¨×¡×¤×‘×¨×™
3. **×”×¨×¡×¤×‘×¨×™** ××‘×¦×¢ unlock ×¢×œ RS485
4. **×”×× ×¢×•×œ** × ×¤×ª×—!

---

## ğŸ“Š API Endpoints ×”×—×“×©×™×

### Agent Communication

```
POST /api/agent/register
POST /api/agent/heartbeat/{branch_id}
GET  /api/agent/commands/{branch_id}
POST /api/agent/command-result
POST /api/agent/disconnect/{branch_id}
```

### ×“×•×’××ª ×©×™××•×© (×œ×‘×“×™×§×” ×™×“× ×™×ª):

```bash
# Register agent
curl -X POST "https://cartwise-cloud.onrender.com/api/agent/register" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "branch_id": "branch_001",
    "agent_type": "raspberry_pi",
    "version": "1.0.0",
    "capabilities": ["rs485", "cu16_controller"]
  }'

# Get commands
curl -X GET "https://cartwise-cloud.onrender.com/api/agent/commands/branch_001" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

---

## ğŸ”§ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª

### ×‘×¢×™×”: Agent ×œ× ××ª×—×‘×¨ ×œ×¢× ×Ÿ

```bash
# ×‘×“×•×§ ×—×™×‘×•×¨ ××™× ×˜×¨× ×˜
ping google.com

# ×‘×“×•×§ URL ×©×œ ×¢× ×Ÿ
curl https://cartwise-cloud.onrender.com/docs

# ×‘×“×•×§ logs
sudo journalctl -u cartwise-agent -n 50
```

### ×‘×¢×™×”: RS485 ×œ× ×¢×•×‘×“

```bash
# ×‘×“×•×§ serial port
ls -l /dev/ttyUSB*

# ×‘×“×•×§ ×”×¨×©××•×ª
groups  # ×•×“× ×©-dialout ×‘×ª×•×š ×”×¨×©×™××”

# ×”×¨×¥ test
cd ~/cartwise
source venv/bin/activate
python test_rs232_adapter.py
```

### ×‘×¢×™×”: Kiosk ×œ× ××•×¤×™×¢

```bash
# ×‘×“×•×§ X server
echo $DISPLAY

# ×”×¨×¥ ×™×“× ×™×ª
DISPLAY=:0 ~/start_kiosk.sh

# ×‘×“×•×§ logs
cat ~/.xsession-errors
```

---

## ğŸ‰ ×¡×™×™××ª!

×¢×›×©×™×• ×™×© ×œ×š ××¢×¨×›×ª ××œ××”:

âœ… **Cloud API** - ×–××™×Ÿ ×œ×›×œ ×”×¢×•×œ×
âœ… **Raspberry Pi Kiosk** - ×××©×§ ×‘×—× ×•×ª
âœ… **Local Agent** - ×©×•×œ×˜ ×‘×× ×¢×•×œ×™×
âœ… **RS485 Communication** - ×¢× ×ª××™×›×” ×‘××ª×××™×

### ××” ×”×œ×§×•×—×•×ª ×™×›×•×œ×™× ×œ×¢×©×•×ª:

1. **×‘××¡×š ×‘×—× ×•×ª** - ×”×©×ª××© ×‘×××©×§ ×¢×œ ×”×¨×¡×¤×‘×¨×™
2. **×‘× ×™×™×“** - ×’×© ×œ-https://cartwise-cloud.onrender.com
3. **×‘××—×©×‘ ×‘×™×ª** - ×’×© ×œ××•×ª×• URL

×”×›×œ ×¢×•×‘×“ ×¢× **××•×ª×•** ×¢× ×Ÿ ×•**××•×ª×•** ×‘×§×¨!

---

**×’×¨×¡×”:** 1.0.0
**×¢×•×“×›×Ÿ:** 2025-10-25
**GitHub:** https://github.com/Arviv123/CartWise
